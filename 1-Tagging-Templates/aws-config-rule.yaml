# AWS Config Rule to Deny Untagged Resources
# This enforces the FinOps Tagging Standard before resources are provisioned.
# Resource Type: AWS::EC2::Instance (for GPU/AI workloads)

Parameters:
  ProjectIDTagKey:
    Type: String
    Default: ProjectID
    Description: The tag key to check for compliance.

Resources:
  AIWorkloadTaggingRule:
    Type: AWS::Config::ConfigRule
    Properties:
      ConfigRuleName: enforce-ai-project-id-tag
      Description: Denies creation of new EC2 instances (GPU/AI) without a ProjectID tag.
      Source:
        Owner: AWS
        SourceIdentifier: REQUIRED_TAGS
      Scope:
        ComplianceResourceTypes:
          - AWS::EC2::Instance
      InputParameters:
        tag1Key: !Ref ProjectIDTagKey
        tag1Value: ".*" # Regex to ensure the value is not empty
      MaximumExecutionFrequency: TwentyFour_Hours

  # Note: Actual denial of creation is often handled by AWS Service Control Policies (SCPs)
  # or customized Lambda functions triggered by the Config Rule, but this sets the compliance standard.